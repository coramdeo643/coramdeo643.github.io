name: Deploy to GitHub Pages

on:
  push:
    branches:
      - main

jobs:
  build_web:
    name: Deploy Flutter Web to GitHub Pages
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Github 레포지토리 세팅
        uses: actions/checkout@v4
      - name: Firebase 옵션 생성
        run: |
          cat > lib/firebase_options.dart << 'EOF'
          // File generated by GitHub Actions
          // ignore_for_file: type=lint
          import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
          import 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;
          
          class DefaultFirebaseOptions {
            static FirebaseOptions get currentPlatform {
              if (kIsWeb) {
                return web;
              }
              switch (defaultTargetPlatform) {
                case TargetPlatform.android:
                  return android;
                case TargetPlatform.iOS:
                  return ios;
                default:
                  throw UnsupportedError('Platform not supported');
              }
            }
          
            static const FirebaseOptions web = FirebaseOptions(
              apiKey: '${{ secrets.FIREBASE_API_KEY }}',
              appId: '1:280220032658:web:057490c491571bc204904b',
              messagingSenderId: '280220032658',
              projectId: 'my-github-flutter-blog',
              authDomain: 'my-github-flutter-blog.firebaseapp.com',
              storageBucket: 'my-github-flutter-blog.firebasestorage.app',
              measurementId: 'G-XBR66EY9TL',
            );
          
            static const FirebaseOptions android = FirebaseOptions(
              apiKey: '${{ secrets.FIREBASE_API_KEY }}',
              appId: '1:280220032658:android:f26d9580afcf9d8704904b',
              messagingSenderId: '280220032658',
              projectId: 'my-github-flutter-blog',
              storageBucket: 'my-github-flutter-blog.firebasestorage.app',
            );
          
            static const FirebaseOptions ios = FirebaseOptions(
              apiKey: '${{ secrets.FIREBASE_API_KEY }}',
              appId: '1:280220032658:ios:cd08be1e5daab58f04904b',
              messagingSenderId: '280220032658',
              projectId: 'my-github-flutter-blog',
              storageBucket: 'my-github-flutter-blog.firebasestorage.app',
              iosBundleId: 'com.example.githubBlog',
            );
          }
          EOF
      - name: Flutter 세팅
        uses: subosito/flutter-action@v2
        with:
          channel: stable
      - name: 캐시된 빌드, Pub 초기화
        run: flutter clean
      - name: Pub 새로 가져오기
        run: flutter pub get
      - name: 플러터 웹 빌드
        run: flutter build web --release
      - name: Github Pages 배포
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_branch: gh-pages
          publish_dir: ./build/web
